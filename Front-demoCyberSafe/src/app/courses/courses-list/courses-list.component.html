<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>All Courses - CyberSafe</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <app-top-bar></app-top-bar>
    
    <!-- Breadcrumb -->
    <div class="breadcrumb">
      <div class="container breadcrumb-container">
        <a routerLink="/" class="breadcrumb-item">Homepage</a>
        <span class="breadcrumb-item">Courses</span>
      </div>
    </div>

    <main class="main-content">
      <div class="container content-container">
        <div class="courses-section">
          <!-- Header Section -->
          <div class="section-header">
            <h1 class="section-title">All Courses</h1>
            <div style="display: flex; align-items: center">
              <!-- Search Bar -->
              <div class="search-bar">
                <input
                  type="text"
                  class="search-input"
                  placeholder="Search"
                  [(ngModel)]="searchTerm"  
                  (input)="onSearch()"
                />
                <button
                  class="search-button"
                  (click)="onSearch()"
                  aria-label="Buscar cursos"
                >
                  <i class="fas fa-search"></i>
                </button>
              </div>
              
              <!-- View Options -->
              <div class="view-options">
                <div
                  class="view-option"
                  [class.active]="viewMode === 'grid'"
                  (click)="setViewMode('grid')"
                >
                  <i class="fas fa-th-large"></i>
                </div>
                <div
                  class="view-option"
                  [class.active]="viewMode === 'list'"
                  (click)="setViewMode('list')"
                >
                  <i class="fas fa-list"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div *ngIf="loading" class="loading-container">
            <i class="fas fa-spinner fa-spin fa-3x"></i>
            <p>Cargando cursos...</p>
          </div>

          <!-- No Results State -->
          <div
            *ngIf="!loading && filteredCourses && filteredCourses.length === 0"
            class="no-results"
          >
            <i class="fas fa-search fa-3x"></i>
            <h3>No se encontraron cursos</h3>
            <p>Intenta ajustar tus filtros de búsqueda o revisa más tarde.</p>
          </div>

          <!-- Courses Grid/List -->
          <div
            [class.course-grid]="viewMode === 'grid'"
            [class.course-list]="viewMode === 'list'"
            *ngIf="!loading && paginatedCourses && paginatedCourses.length > 0"
          >
            <div
              *ngFor="let course of paginatedCourses"
              class="course-card"
              (click)="navigateToACourse(course.nombre)"
            >
              <div class="course-image">
                <img
                  [src]="
                    course.url_foto_curso ||
                    './assets/courses-img/default-course.png'
                  "
                  [alt]="course.nombre"
                  (error)="onImageError($event)"
                />
              </div>
              <div class="course-content">
                <div class="course-instructor">
                  por {{ course.nombre_profesor || "CyberSafe Team" }}
                </div>
                <h3 class="course-title">{{ course.nombre }}</h3>
                <div class="course-meta">
                  <div class="course-duration">
                    <i class="far fa-clock"></i>
                    <span>{{ course.duracion || "A tu ritmo" }}</span>
                  </div>
                  <div class="course-students">
                    <i class="far fa-user"></i>
                    <span>{{
                      course.numero_de_estudiantes | number
                    }} Estudiantes</span>
                  </div>
                </div>
                <div
                  class="course-rating"
                  *ngIf="
                    course.calificacion !== undefined &&
                    course.calificacion !== null
                  "
                >
                  <div class="stars">
                    <i
                      *ngFor="let star of getStarArray(course.calificacion)"
                      class="fas fa-star"
                      [class.empty]="!star"
                    ></i>
                  </div>
                  <span class="rating-number">({{ course.calificacion }})</span>
                </div>
                <div class="course-footer">
                  <div class="course-price">
                    <span
                      class="current-price"
                      [class.free]="course.precio === 0"
                    >
                      {{
                        course.precio === 0
                          ? "Gratis"
                          : (course.precio | currency : "USD" : "symbol" : "1.0-0")
                      }}
                    </span>
                  </div>
                  <a
                    class="view-more"
                    (click)="
                      $event.stopPropagation(); navigateToACourse(course.nombre)
                    "
                  >
                    Ver Más
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- Pagination for loadCourses (main course loading) -->
          <div class="pagination" *ngIf="!loading && courses && courses.length > 0">
            <a
              href="javascript:void(0);"
              class="page-item"
              [class.disabled]="page === 1"
              (click)="loadCourses(page - 1)"
            >
              <i class="fas fa-chevron-left"></i>
            </a>
            
            <a 
              (click)="loadCourses(1)" 
              [class.active]="page === 1" 
              class="page-item"
              href="javascript:void(0);"
            >
              1
            </a>
            <a 
              (click)="loadCourses(2)" 
              [class.active]="page === 2" 
              class="page-item"
              href="javascript:void(0);"
            >
              2
            </a>          
            
            <a
              href="javascript:void(0);"
              class="page-item"
              [class.disabled]="page === 3"
              (click)="loadCourses(page + 1)"
            >
              <i class="fas fa-chevron-right"></i>
            </a>
          </div>

          <!-- Secondary Pagination (for filtered courses within current page) -->
          <div
            class="pagination secondary-pagination"
            *ngIf="
              !loading &&
              filteredCourses &&
              filteredCourses.length > coursesPerPage &&
              (searchTerm || selectedInstructors.length > 0 || priceFilter !== 'all' || selectedRatings.length > 0)
            "
          >
            <small>Filtros aplicados:</small>
            <a
              href="javascript:void(0);"
              class="page-item"
              [class.disabled]="currentPage === 1"
              (click)="goToPage(currentPage - 1)"
            >
              <i class="fas fa-chevron-left"></i>
            </a>

            <a
              *ngFor="let pageNum of getPageNumbers()"
              href="javascript:void(0);"
              class="page-item"
              [class.active]="pageNum === currentPage"
              (click)="pageNum !== -1 && goToPage(pageNum)"
            >
              <ng-container *ngIf="pageNum !== -1">{{ pageNum }}</ng-container>
              <ng-container *ngIf="pageNum === -1">...</ng-container>
            </a>

            <a
              href="javascript:void(0);"
              class="page-item"
              [class.disabled]="currentPage === totalPages"
              (click)="goToPage(currentPage + 1)"
            >
              <i class="fas fa-chevron-right"></i>
            </a>
          </div>
        </div>

        <!-- Sidebar with Filters -->
        <div class="sidebar">
          <!-- Instructors Filter -->
          <div class="sidebar-section">
            <h3 class="sidebar-title">Instructors</h3>
            <div class="filter-list">
              <div
                *ngFor="let instructor of instructorsList"
                class="filter-item"
              >
                <div>
                  <input
                    type="checkbox"
                    [id]="'inst-' + instructor.id"
                    class="filter-checkbox"
                    [checked]="selectedInstructors.includes(instructor.name)"
                    (change)="onInstructorChange(instructor.name, $event)"
                  />
                  <label [for]="'inst-' + instructor.id">{{
                    instructor.name
                  }}</label>
                </div>
                <span class="filter-count">{{ instructor.count }}</span>
              </div>
            </div>
          </div>

          <!-- Price Filter -->
          <div class="sidebar-section">
            <h3 class="sidebar-title">Price</h3>
            <div class="filter-list">
              <div class="filter-item">
                <div>
                  <input
                    type="radio"
                    id="price-all"
                    name="priceFilter"
                    class="filter-checkbox"
                    [checked]="priceFilter === 'all'"
                    (change)="onPriceFilterChange('all')"
                  />
                  <label for="price-all">All</label>
                </div>
                <span class="filter-count">{{ courses.length }}</span>
              </div>
              <div class="filter-item">
                <div>
                  <input
                    type="radio"
                    id="price-free"
                    name="priceFilter"
                    class="filter-checkbox"
                    [checked]="priceFilter === 'gratis'"
                    (change)="onPriceFilterChange('gratis')"
                  />
                  <label for="price-free">Free</label>
                </div>
                <span class="filter-count">{{ freeCoursesCount }}</span>
              </div>
              <div class="filter-item">
                <div>
                  <input
                    type="radio"
                    id="price-paid"
                    name="priceFilter"
                    class="filter-checkbox"
                    [checked]="priceFilter === 'Pago único'"
                    (change)="onPriceFilterChange('Pago único')"
                  />
                  <label for="price-paid">Paid</label>
                </div>
                <span class="filter-count">{{ paidCoursesCount }}</span>
              </div>
            </div>
          </div>

          <!-- Rating Filter -->
          <div class="sidebar-section">
            <h3 class="sidebar-title">Review</h3>
            <div class="filter-list">
              <div *ngFor="let rating of ratingFilters" class="filter-item">
                <div>
                  <input
                    type="checkbox"
                    [id]="'review-' + rating.stars"
                    class="filter-checkbox"
                    [checked]="selectedRatings.includes(rating.stars)"
                    (change)="onRatingChange(rating.stars, $event)"
                  />
                  <label [for]="'review-' + rating.stars">
                    <div class="star-rating">
                      <i
                        *ngFor="let star of [1, 2, 3, 4, 5]"
                        class="fas fa-star"
                        [class.empty]="star > rating.stars"
                      ></i>
                    </div>
                  </label>
                </div>
                <span class="filter-count">({{ rating.count }})</span>
              </div>
            </div>
          </div>

          <!-- Clear Filters Button -->
          <div class="clear-filters">
            <button class="btn btn-outline" (click)="clearAllFilters()">
              <i class="fas fa-times"></i>
              Limpiar Filtros
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-container">
          <div>
            <div class="footer-logo">
              <img src="./assets/logo_small.png" alt="CyberSafe Logo" />
            </div>
            <p class="footer-about">
              ¿Sabrías identificar un correo falso o bloquear un ataque de
              ransomware? No dejes tu seguridad al azar: conviértete en tu
              propio firewall humano.
            </p>
            <div class="social-links">
              <a href="#" class="social-link">
                <i class="fab fa-facebook-f"></i>
              </a>
              <a href="#" class="social-link">
                <i class="fab fa-pinterest-p"></i>
              </a>
              <a href="#" class="social-link">
                <i class="fab fa-twitter"></i>
              </a>
              <a href="#" class="social-link">
                <i class="fab fa-instagram"></i>
              </a>
              <a href="#" class="social-link">
                <i class="fab fa-youtube"></i>
              </a>
            </div>
          </div>

          <div>
            <h3 class="footer-section-title">Ayuda</h3>
            <ul class="footer-links">
              <li><a routerLink="/contact">Contáctanos</a></li>
              <li><a routerLink="/blog">Blogs</a></li>
              <li><a routerLink="/faq">FAQ</a></li>
            </ul>
          </div>

          <div>
            <h3 class="footer-section-title">Contáctanos</h3>
            <div class="footer-contact-item">
              <strong>Address:</strong> Calle 182 #42-82
            </div>
            <div class="footer-contact-item">
              <strong>Tel:</strong> +57 3118458554
            </div>
            <div class="footer-contact-item">
              <strong>Mail:</strong> cybersafehub.dg&commat;gmail.com
            </div>
          </div>
        </div>

        <div class="footer-bottom">
          <p>Copyright © 2024 LearnPress LMS | Powered by ThimPress</p>
        </div>
      </div>
    </footer>

    <!-- Back to Top Button -->
    <div class="back-to-top" (click)="scrollToTop()">
      <i class="fas fa-arrow-up"></i>
    </div>
  </body>
</html>