<!-- Loading State -->
<div *ngIf="loading" class="loading-container">
  <div class="loading-spinner">Cargando reseñas...</div>
</div>

<!-- Error State -->
<div *ngIf="error" class="error-container">
  <div class="error-message">{{ error }}</div>
</div>

<!-- Course Content -->
<section class="course-content" *ngIf="!loading && !error">
  <div class="container content-container">
    <div class="main-content">
      <div class="profile-card">
        <div class="profile-image"></div>

        <div class="comments-container">
          <h2 class="comments-header">Comments</h2>

          <!-- Rating Summary -->
          <div class="rating-summary">
            <div class="rating-number">{{ averageRating }}</div>
            <div>
              <div class="rating-stars">
                <span [innerHTML]="getStars(averageRating)"></span>
              </div>
              <div class="rating-count">
                based on {{ reviews.length }} ratings
              </div>
            </div>
          </div>

          <!-- Rating Breakdown -->
          <div class="rating-breakdown">
            @for (breakdown of ratingBreakdown; track breakdown.rating) {
            <div class="rating-row">
              <div class="rating-stars-small">
                <span [innerHTML]="getStars(breakdown.rating)"></span>
              </div>
              <div class="rating-percentage">
                {{ breakdown.percentage | number : "1.0-0" }}%
              </div>
              <div class="rating-bar-container">
                <div
                  class="rating-bar"
                  [style.width.%]="breakdown.percentage"
                ></div>
              </div>
            </div>
            }
          </div>

          <!-- Comments List -->
          <div class="comments-list" *ngIf="reviews.length > 0">
            @for (review of reviews; track $index) {
            <div class="comment">
              <div class="comment-avatar">
                <img
                  src="assets/001-student1.png"
                  [alt]="review.nombre_reviewer"
                />
              </div>
              <div class="comment-content">
                <div class="comment-header">
                  <div class="comment-author">{{ review.nombre_reviewer }}</div>
                  <div class="comment-date">
                    {{ review.fecha || "Fecha no disponible" }}
                  </div>
                </div>
                <div class="comment-rating" *ngIf="review.calificacion > 0">
                  <span [innerHTML]="getStars(review.calificacion)"></span>
                </div>
                <div class="comment-text">{{ review.opinion }}</div>
                <a href="#" class="comment-reply">
                  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M10,9V5L3,12L10,19V15C15,15 18,18 21,21C20,15 17,10 10,9Z"
                    />
                  </svg>
                  Reply
                </a>
              </div>
            </div>
            }
          </div>

          <!-- No Reviews Message -->
          <div *ngIf="reviews.length === 0" class="no-reviews">
            <p>No hay reseñas disponibles para este curso.</p>
          </div>

          <!-- Pagination -->
          <div class="pagination" *ngIf="reviews.length > 0">
            <div class="pagination-arrow">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M15.41 7.41L14 6L8 12L14 18L15.41 16.59L10.83 12L15.41 7.41Z"
                  fill="#333"
                />
              </svg>
            </div>
            <div class="pagination-item active">1</div>
            <div class="pagination-item">2</div>
            <div class="pagination-item">3</div>
            <div class="pagination-arrow">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M8.59 16.59L10 18L16 12L10 6L8.59 7.41L13.17 12L8.59 16.59Z"
                  fill="#333"
                />
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Comment Section -->
      <div class="comment-section">
        <h3 class="section-title">Leave A Comment</h3>
        <p class="comment-note">
          Your email address will not be published. Required fields are marked *
        </p>

        <form class="comment-form">
          <div class="form-row">
            <div class="form-group">
              <input
                type="text"
                class="form-control"
                placeholder="Name*"
                required
              />
            </div>
            <div class="form-group">
              <input
                type="email"
                class="form-control"
                placeholder="Email*"
                required
              />
            </div>
          </div>
          <div class="form-group">
            <textarea
              class="form-control"
              placeholder="Comment"
              rows="5"
            ></textarea>
          </div>
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="saveInfo" />
            <label for="saveInfo"
              >Save my name, email in this browser for the next time I
              comment</label
            >
          </div>
          <button type="submit" class="submit-button">Post Comment</button>
        </form>
      </div>
    </div>
  </div>
</section>
